<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<title>PT</title>
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<link rel="shortcut icon" href="images/pt/fav.ico">
	<link href="css/share.css" media="screen" rel="stylesheet" type="text/css">
	<link href="css/css.css" media="screen" rel="stylesheet" type="text/css">
	<link href="css/pagination.css" media="screen" rel="stylesheet" type="text/css">
	<link href="css/game.css" media="screen" rel="stylesheet" type="text/css">
	<!-- 跳頁 開始-->
	<script src="js/jquery-1.12.4.js"></script>
	<script src="js/jquery-ui.js"></script>
	<script src="js/pagination.min.js"></script>
	<script type="text/javascript" src="https://login.winforfun88.com/jswrapper/integration.js.php?casino=winforfun88"></script>
	<!-- 頁數背景style start-->
	<style>
		.bg {
			background-image: url(images/pt/mgpage.png);
			background-position: center center;
			background-size: cover;
			border-radius: 5px;
			margin-left: 5px;
		}
		.search-form{position: relative;}
		.searcBtn{width: 30px;height: 30px;
			 position: absolute;bottom:0;right:0;background: transparent;border:0;
			 background-image: url(images/search_icon.png);background-repeat: no-repeat;
			cursor: pointer;}
	</style>
	<script>
		$(function () {
			$("#tabs").tabs();
			game();
			// 鍵盤 enter
			$('#search-input').keydown(function(event){
				if( event.which == 13 ) {
					game();
				}
			});
		});

		function game(){
			$(".Pagination").pagination({
				//items: 174,
				//itemsOnPage: 3,
				pageSize: 20,
				className: 'paginationjs-gamelabel',
				//cssStyle: 'light-theme',
				dataSource: function (done) {
					$.ajax({
						type: 'GET',
						url: 'json/pt-game-list.json',
						dataType: 'json',
						complete: function (response) {
							var searchText = $("#search-input").val();
							var gameList = JSON.stringify(response.responseJSON);
							var result = [],
								resultList =  response.responseJSON.list;
							if (searchText == ''){
								result_game = resultList;
							} else{
								var res = [];
								resultList.forEach(function(i) {
									var name = i.cname,
									code = i.code,
									ename = i.ename;
									if(name.indexOf(searchText) != -1){
										res.push({'cname':name , 'code':code ,'ename':ename});
									}
								});
								result_game = res
							}
							done(result_game);
							// done(result);
							// console.log(result);
							$("#totalitem").text('[' + result_game.length + ']');
						}
					});
				},
				callback: function (index, pagination) {
					showNum = pagination.pageSize;
					currpage = pagination.pageNumber;
					dataL = pagination.totalNumber;
					var html = '';
					for (var i = 0; i < index.length; i++) {
						var code = index[i].code; //遊戲代碼
						var ename = index[i].ename; //遊戲英文名稱
						var cname = index[i].cname; //遊戲中文名稱

						if (i % 5 == 0) {
							if (i != 0) {
								html += '</div>';
							}
							html += '<div class="mgwrap" style="display: inline-flex;margin-left: -8px;">';
						}
						html += '<div class="wrap" data-index="' + ename + '" style="width:200px">';
						html += '<div class="mgbox">';
						html += '<div class="mgimg"> <a class="gameLink" href="javascript:void(0)" onclick="playGame(\'' + code +
							'\')" style="background-image:url(images/pt/' + code +
							'.png); "></a></div>';
						html += '<div class="mgbtxt"><a class="gameLink" href="javascript:void(0)" onclick="playGame(\'' + code +
							'\')">' + cname + '</a></div>';
						html += '</div>';
						html += '</div>';
					}
					$('.list').html(html);
					if (html == ''){
						$('.list').append('<h2 style="color: #fff;text-align: center;">查无数据 </h2> ');
					}
					$('#search-input').val('');
				}
			});			
			
		}
		// function search() {
		// 	$(".list , #pagination , #totalitem").html(''); //清空html

		// 	var searchText = $("#search-input").val();
		// 	if (searchText == ''){
				
		// 	} else{

		// 	}
		// }
		var mobiledomain = "ld176988.com";
		var systemidvar = "424";
		var language = 'zh-cn';
		var user = '';
		var gameId = '';

		function playGame(game) {
			$.ajax({
				url: '/?r=game/login/index',
				type: 'GET',
				dataType: 'json',
				async: false, // 此处必须定义为同步
				data: {
					type: '1009',
					game: game
				},
				complete: function (data) {
					if (data.responseJSON) {
						user = data.responseJSON.name;
						gameId = game;
						iapiSetClientPlatform("mobile&deliveryPlatform=HTML5");
						var realMode = 1;
						iapiLogin(data.responseJSON.name, data.responseJSON.pwd, realMode, language);
					} else {
						alert(data.responseText);
					}
				}
			});
		}

		iapiSetCallout('Login', calloutLogin);

		function calloutLogin(response) {
			if (response.errorCode) {
				alert("Login failed. " + response.playerMessage + " Error code: " + response.errorCode);
			} else {
				askTempandLaunchGame(gameId);
			}
		}

		function askTempandLaunchGame(gameId) {
			currentgame = gameId;
			var realMode = 1;
			iapiRequestTemporaryToken(realMode, systemidvar, 'GamePlay');
			iapiSetCallout('GetTemporaryAuthenticationToken', calloutGetTemporaryAuthenticationToken);
		}

		function calloutGetTemporaryAuthenticationToken(response) {
			if (response.errorCode) {
				alert("Token failed. " + response.playerMessage + " Error code: " + response.errorCode);
			} else {
				launchMobileClient(response.sessionToken.sessionToken);
			}
		}

		function launchMobileClient(temptoken) {
			//var clientUrl = 'http://hub.' + mobiledomain + '/igaming/' + '?gameId=' + currentgame + '&real=1' + '&username=' + getUrlVars()["username"] + '&lang=' + language + '&tempToken=' + temptoken + '&lobby=' + location.href.substring(0,location.href.lastIndexOf('/')+1) + 'lobby.html' + '&support=' + location.href.substring(0,location.href.lastIndexOf('/')+1) + 'support.html' + '&logout=' + location.href.substring(0,location.href.lastIndexOf('/')+1) + 'logout.html' + '&deposit=' + location.href.substring(0,location.href.lastIndexOf('/')+1) + 'deposit.html';
			var clientUrl = 'http://hub.' + mobiledomain + '/igaming/' + '?gameId=' + currentgame + '&real=1' + '&username=' +
				user + '&lang=' + language + '&tempToken=' + temptoken + '&lobby=' + location.href +
				'&support=htcmd:close&logout=htcmd:close&deposit=htcmd:close';
			document.location = clientUrl;
			//window.location.href = clientUrl;
			//window.location.target = "pt_game";
			//window.open(clientUrl, 'pt_game');
			/*
			var popup = window.open('about:blank', '_blank');
			$.ajax({
				url: clientUrl,
				type: 'GET',
				async: true,  // 此处必须定义为同步
				complete: function(data){
					window.open(this.url, 'pt_game');
				}
			})
			*/

		}
	</script>
	<!-- 跳頁 結束-->
</head>

<body>
	<div id="wrapbox">
		<div id="wrapw">
			<div class="gamemiddleboxcenter">
				<div class="newgame_menubox">
					<ul>
						<li><a href="game-pt.html" class="cur">PT电子</a></li>
					</ul>
				</div>
				<div class="newgame_banner">
					<div class="newgame_banner_in ngb_pt">
						<div class="newgame_search">
							<!-- search start -->
							<div class="search-bar" style="padding: 10px 10px 0 10px;position: relative;">
								<div class="search-form">
									<input id="search-input" class="form-control" placeholder="请输入游戏名称" name="game" style="padding: 6px 24px;" />
									<input type="button" id="m-search" class="searcBtn" onclick='game();' />
								</div>
							</div>
							<script>
								// var that = $(this);
								// var mSearch = $("#m-search");
								// $("#search-input").bind("change paste keyup", function () {
								// 	var value = $(this).val();
								// 	console.log(value);
								// 	if (!value) {
								// 		mSearch.html("");
								// 		return;
								// 	};
								// 	mSearch.html('.wrap:not([data-index*="' + value.toLowerCase() +
								// 		'"]) {display: none;}');
								// });
							</script>
							<!-- search end -->
						</div>
					</div>
				</div>
				<div class="newgame_menu2">
					<div class="newgame_menu2_text">游戏分类：</div>
					<div class="newgame_menu2_list">
						<a href="game-pt.html" class="cur">全部游戏</a>
						<!--
						<a href="popular.html">热门游戏</a>
						<a href="video.html">视频扑克</a>
						<a href="table.html">桌牌</a>
						<a href="slot.html">老虎机</a>
						<a href="other.html">其它</a>
						-->
					</div>
				</div>


				<div class="newgame_main">
					<div id="tabs">
						<div class="list"></div>
					</div>
				</div>
				<div class="setPageDiv">
					<div><span class="totalitem" id="totalitem"></span></div>
					<div class="Pagination" id="pagination"></div>
				</div>
			</div>
		</div>
	</div>
</body>

</html>